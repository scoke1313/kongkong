<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>춘식이 모션 전환 테스트</title>
  <script src="https://unpkg.com/@rive-app/canvas@latest"></script>
  <style>
    body { margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: #eee; font-family: sans-serif; }
    /* 86x138 필승 규격 */
    #chunCanvas { width: 86px !important; height: 138px !important; background: white; border: 2px solid #FEE500; }
    .controls { margin-top: 20px; text-align: center; }
  </style>
</head>
<body>

  <canvas id="chunCanvas"></canvas>
  
  <div class="controls">
    <p id="status">로딩 중...</p>
    <p>화면을 클릭하거나 <b>스페이스바</b>를 눌러보세요!</p>
  </div>

  <script>
    const canvas = document.getElementById('chunCanvas');
    const statusText = document.getElementById('status');
    let landRive, airRive, currentRive;
    let isAir = false;

    // 1. 개별 로드 (사라짐 방지 필살기)
    function init() {
      landRive = new rive.Rive({
        src: 'kongsik_ingame_land.riv',
        canvas: canvas,
        artboard: 'Artboard',
        stateMachines: 'State Machine 1',
        autoplay: false,
        onLoad: () => { checkReady(); }
      });

      airRive = new rive.Rive({
        src: 'kongsik_ingame_air.riv',
        canvas: canvas,
        artboard: 'Artboard',
        stateMachines: 'State Machine 1',
        autoplay: false,
        onLoad: () => { checkReady(); }
      });
    }

    let loaded = 0;
    function checkReady() {
      loaded++;
      if(loaded === 2) {
        statusText.innerText = "준비 완료! 현재: 착지(LAND) 모션";
        landRive.resizeDrawingSurfaceToCanvas();
        airRive.resizeDrawingSurfaceToCanvas();
        currentRive = landRive;
        currentRive.play(); // 첫 모션 재생
      }
    }

    // 2. 모션 교체 함수 (사용자님의 점프 로직에 들어갈 핵심)
    function toggleMotion() {
      if(loaded < 2) return;

      isAir = !isAir;
      
      // 이전 모션 멈춤 (pause 사용으로 캐릭터 증발 방지)
      if (currentRive) currentRive.pause();

      if (isAir) {
        currentRive = airRive;
        statusText.innerText = "현재: 공중(AIR) 모션";
      } else {
        currentRive = landRive;
        currentRive.scrub("State Machine 1", 0); // 처음부터 한 번만 재생
        statusText.innerText = "현재: 착지(LAND) 모션";
      }

      currentRive.play();
    }

    // 입력 이벤트 등록
    window.addEventListener('mousedown', toggleMotion);
    window.addEventListener('keydown', (e) => { if(e.code === 'Space') toggleMotion(); });

    init();
  </script>
</body>
</html>
