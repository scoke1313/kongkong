<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶˜ì‹ì´ ì í”„ ë¬¼ë¦¬ í…ŒìŠ¤íŠ¸</title>
  <script src="https://unpkg.com/@rive-app/canvas@latest"></script>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #A1C4FD; }
    #container { position: relative; width: 480px; height: 800px; background: white; overflow: hidden; border: 2px solid #fff; }
    
    /* í•„ìŠ¹ ë¹„ë²•: 86x138 íˆ¬ëª… ìº”ë²„ìŠ¤ */
    #chunCanvas { 
      position: absolute; 
      width: 86px !important; 
      height: 138px !important; 
      z-index: 2; 
      pointer-events: none;
    }
    .info { position: absolute; top: 10px; width: 100%; text-align: center; color: #333; font-weight: bold; z-index: 10; }
  </style>
</head>
<body>
  <div id="container">
    <div class="info" id="status">ìºë¦­í„° ë¡œë”© ì¤‘...</div>
    <canvas id="chunCanvas"></canvas>
  </div>

  <script>
    const canvas = document.getElementById('chunCanvas');
    const statusText = document.getElementById('status');
    let landRive, airRive, currentRive;
    let landReady = false, airReady = false;

    // 1. ë¬¼ë¦¬ ë³€ìˆ˜ ì„¤ì • (0.7ì´ˆ ì²´ë¥˜ ì í”„ ê¸°ë°˜)
    let jumpPower = -15; // ì í”„ í˜
    let gravity = 0.6;   // ì¤‘ë ¥
    let p = { x: 197, y: 600, vy: jumpPower }; // ìœ„ì¹˜ ë° ì†ë„
    let isRunning = false;

    // 2. ë¦¬ë¸Œ íŒŒì¼ ê°œë³„ ë¡œë“œ (í•„ìŠ¹ ë¹„ë²•)
    function init() {
      landRive = new rive.Rive({
        [cite_start]src: 'kongsik_ingame_land.riv', [cite: 1378]
        canvas: canvas,
        artboard: 'Artboard',
        stateMachines: 'State Machine 1',
        autoplay: false,
        onLoad: () => { 
          landRive.resizeDrawingSurfaceToCanvas();
          landReady = true; checkStart(); 
        }
      });

      airRive = new rive.Rive({
        [cite_start]src: 'kongsik_ingame_air.riv', [cite: 1090]
        canvas: canvas,
        artboard: 'Artboard',
        stateMachines: 'State Machine 1',
        autoplay: false,
        onLoad: () => { 
          airRive.resizeDrawingSurfaceToCanvas();
          airReady = true; checkStart(); 
        }
      });
    }

    function checkStart() {
      if(landReady && airReady) {
        statusText.innerText = "í™”ë©´ì„ í´ë¦­í•˜ë©´ ì í”„ ì‹œì‘! ğŸ¯";
        window.addEventListener('mousedown', () => { if(!isRunning) { isRunning = true; loop(); } });
      }
    }

    // 3. ê²Œì„ ë£¨í”„ (ìƒìŠ¹/í•˜ê°•ì— ë”°ë¥¸ ëª¨ì…˜ ìŠ¤ìœ„ì¹­)
    function loop() {
      // ë¬¼ë¦¬ ì—°ì‚°
      p.vy += gravity; 
      p.y += p.vy;

      // ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ë‹¤ì‹œ ì í”„ (ì„ì‹œ ë°”ë‹¥ 700px)
      if (p.y > 600) {
        p.y = 600;
        p.vy = jumpPower;

        // [ëª¨ì…˜ êµì²´] ë°”ë‹¥ì— ë‹¿ëŠ” ìˆœê°„ LAND ëª¨ì…˜ 1íšŒ ì¬ìƒ
        currentRive = landRive;
        currentRive.scrub("State Machine 1", 0); // ì²˜ìŒìœ¼ë¡œ ë¦¬ì…‹
        currentRive.play("State Machine 1");
      }

      // [ëª¨ì…˜ êµì²´] ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” ì¤‘ì¼ ë•ŒëŠ” AIR ëª¨ì…˜ ìœ ì§€
      if (p.vy < 0 && p.y < 580) { // ë°”ë‹¥ì—ì„œ ì‚´ì§ ë–¨ì–´ì¡Œì„ ë•Œ ì „í™˜
        if (currentRive !== airRive) {
          currentRive = airRive;
          currentRive.play(); 
        }
      }

      // ìº”ë²„ìŠ¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      canvas.style.left = p.x + 'px';
      canvas.style.top = p.y + 'px';

      requestAnimationFrame(loop);
    }

    init();
  </script>
</body>
</html>
